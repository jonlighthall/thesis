%% This file prints the time of compiling.
%  Requires package datetime.
%  Requires the following commands to be defined: longusedate, timezone, changemargin
%  The prerequisite commands are defined in packages.tex
%  Note: the timezone command requires latexmkrc file on Overleaf

%  Time zone definitions, for the command \timezone.
% Requires latexmkrc file on Overleaf
\makeatletter
\newif\ifdst
% set daylight saving time
\dstfalse
% set time zone names
\ifdst
  \@namedef{timezone-0400}{EDT}
  \@namedef{timezone-0500}{CDT}
  \@namedef{timezone-0600}{MDT}
  \@namedef{timezone-0700}{PDT}
\else
  \@namedef{timezone-0500}{EST}
  \@namedef{timezone-0600}{CST}
  \@namedef{timezone-0700}{MST}
  \@namedef{timezone-0800}{PST}
\fi

\def\grabtimezone #1#2#3#4#5#6#7#8#9{\grabtimezoneB}
\def\grabtimezoneB #1#2#3#4#5#6#7{\grabtimezoneC}
\def\grabtimezoneC #1#2'#3'{%
  \@ifundefined{timezone#1#2#3}
    {No timezone for `#1#2#3'}
    {\@nameuse{timezone#1#2#3}}%
}
\def\timezone{\expandafter\grabtimezone\pdfcreationdate}% called with \timezone.
\makeatother

\newdateformat{shortusdate}{%standard short date format
\shortdayofweekname{\THEDAY}{\THEMONTH}{\THEYEAR}, \shortmonthname[\THEMONTH] \ordinal{DAY}, \THEYEAR}
\newcommand{\smalltimestamp}{Updated \shortusdate\today{} \currenttime{} \timezone.}

%\nopagebreak[4]
\AtEndDocument{
%% The need to include one of the following two lines may be system dependent.
%\pagebreak % use if float(s) on last page 
%\nopagebreak[4] % use if text on last page (if needed)
 \makeatletter 
  \if@twocolumn
    \tiny
      \fi
\makeatother

   \begin{singlespace}
         \begin{center}
           \rule[0 pt]{\linewidth}{0.5pt}\\	
             \textit{(end of document)}\\
      \vspace*{\fill}
%\vspace*{\stretch{1}}
%\begin{figure*}[h]%
%\centering
%\includegraphics[keepaspectratio,height=0.25\textheight,width=0.25\columnwidth]{monogram}%
%\end{figure*}
%\input{colophon}
%\vspace*{\stretch{1}}
%\input{src/time_stamp}
\begin{changemargin}{-\marginparwidth}%
{%\footnotesize
\begin{center}
At the time of compiling, today is \longusdate\today{} and the current time is \currenttime{} 
\ifthenelse{\THEHOUR<12}{{}(\amstring) }{%
\ifthenelse{\THEHOUR=12}{{}(\pmstring) }{}}% 
\timezone.%
%%\\\enlargethispage{\baselineskip}{\color{white}Document designed by Jonathan C. Lighthall}
\end{center}
}
\end{changemargin}
\end{center}
\end{singlespace}
%\marginpar{\color{white}\texttt{J/\textbackslash C\textbar\textless @L}}
}
